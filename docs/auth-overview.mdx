---
id: auth-overview
title: Authentication
sidebar_label: Overview
slug: /auth-overview
description: Pyroscope Server Authentication
keywords: [ pyroscope, server, config, github, auth, oauth2, authentication, authorization ]
---

:::note
This functionality is available starting from version 0.10.0. Make sure to upgrade before you use this.
:::

## Authentication Providers

Pyroscope server has a built-in user authentication system with support for external providers. By default, user
authentication is disabled.

Internal authentication provider implements login-password authentication mechanism based on JSON Web Tokens using the
internal database. Please see the [internal authentication provider](auth-internal.mdx) page for more details on how to
enable and configure it. The list of external authentication providers includes:
 - [Google OAuth2](auth-google.mdx)
 - [Github OAuth2](auth-github.mdx)
 - [Gitlab OAuth2](auth-gitlab.mdx)

Internal and external providers can be used independently.

When the internal authentication provider is enabled, administrators can also allow users to sign up. On successful
authentication with an external provider, user accounts are created in the internal database automatically, and
administrators are able to manage them. By default, users are granted `ReadOnly` role on sign up, which can be changed
in the server configuration.

Pyroscope Server has a built-in `admin` user with administrative permissions: the account is being created during the
first launch and this can be altered by changing the configuration options. Please refer to the [internal authentication provider](auth-internal.mdx)
documentation.

:::note
Users signed up via OAuth providers are not allowed to use password authentication.
:::

Below you can see available configuration options and their default values.

```yaml
auth:
  # Specifies which role will be granted to a newly signed up user.
  # Supported roles: Admin, ReadOnly. Defaults to ReadOnly.
  # The parameter affects all authentication providers.
  signup-default-role: ReadOnly

  # Specifies SameSite attribute for the JWT token cookie.
  # Supported values: Lax, Strict, None. Default to Lax.
  cookie-same-site: Lax

  # Specifies Secure attribute for the JWT token cookie.
  # If cookie-same-site is set to None, Secure attribute
  # will be set automatically. Default to false.
  cookie-secure: false

  # JWT signing string. Generated at provisioning if not specified explicitly.
  jwt-secret: ""

  # Amount of days after which user will be logged out. 0 means non-expiring.
  login-maximum-lifetime-days: 0

  # Data ingestion authentication options.
  ingestion:
    enabled: false

  # Internal authentication provider settings.
  internal:
    enabled: false

  # Google OAuth2 authentication settings.
  google:
    enabled: false

  # Github OAuth2 authentication settings.
  github:
    enabled: false

  # Gitlab OAuth2 authentication settings.
  gitlab:
    enabled: false

```

The options can be also specified via CLI flags or environment variables. See the [server configuration](configuration.mdx)
page for more details on the Pyroscope configuration.

:::note
Pyroscope Server stores user authentication tokens in Cookies. Be default, the cookie is attributed with `SameSite: Lax`
value meaning that it is not sent on normal cross-site subrequests (for example to load images or frames into a third
party site), but is sent when a user is navigating to the origin site (i.e., when following a link). This ensures that
users have reasonably robust defense against some classes of cross-site request forgery (CSRF) attacks.

You can configure `auth.cookie-same-site` parameter to override this.

Please see **[the documentation](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie/SameSite)** to learn more.
:::

## API Key Authentication

When one of the authentication providers configured, [API clients](server-api-reference.mdx) should provide an
authentication token. You can generate it via the UI, if you have `Admin` role:
1. Log in using an account with the **Admin** role.
2. Navigate to **Settings** page in the left sidebar.
3. Open **API keys** tab.
4. Click on **Add Key** button.
5. Type in a descriptive unique API key name.
6. Select the appropriate role.
7. Specify expiration period in seconds. Set 0, if you want the key to never expire.
8. Click **Add API Key** button.
9. Copy the key. The key is not stored and can't be viewed after the creation.

## Agent Authentication

Pyroscope Server can be configured to require authentication from the agents ingesting data in the push mode.
By default, anyone can send data to Pyroscope Server without any authentication.

### 1. Enable Agent Authentication

In order to secure the data ingestion, specify the `auth.ingestion.enabled` parameter in the Pyroscope configuration file:

```yaml
auth:
  ingestion:
    enabled: true
```

The options can be also specified via CLI flags or environment variables. See the [server configuration](configuration.mdx)
page for more details on the Pyroscope configuration.

You will need to restart Pyroscope Server for the configuration to take effect.

### 2. Get API Key

First, we need to get an API key with the `Agent` role that would agents to authenticate and ingest data.
[API Key Authentication](#api-key-authentication) paragraph describes how a new key can be generated.

### 3. Specify Authentication Token

Now the API Key should be provided to the agent as the authentication token. The way an authentication token is specified
on the agent side depends on the integration used and is described in [the corresponding page](agent-overview.mdx).

For example, in Go you should specify `AuthToken` configuration parameter:
```go
package main

import "github.com/pyroscope-io/client/pyroscope"

func main() {
  pyroscope.Start(pyroscope.Config{
    ApplicationName: "simple.golang.app",
    ServerAddress:   "http://pyroscope-server:4040",
    AuthToken:       os.Getenv("PYROSCOPE_AUTH_TOKEN"),
  })

  // your code goes here
}
```

If the application is profiled using `exec` or `connect` mode, we recommend you specifying the API Key via the
`PYROSCOPE_AUTH_TOKEN` environment variable.

## Migrating From Previous Versions

In versions before 0.10.0, Pyroscope Server only supported OAuth providers and had no concept of user management.
If you already use OAuth authentication providers, after upgrading to 0.10.0, by default you will be granted `ReadOnly`
role that does not allow you managing Users and API keys:

1. If you only use OAuth providers, we recommend you to change `auth.signup-default-role` to `Admin` at the first launch.
Alternatively, you can enable the internal authentication provider via the `auth.internal.enabled` option, log in using
the default `admin` credentials, and grant `Admin` role to eligible users.

2. If you decided to enable the internal authentication provider and allow users to signup via the
`auth.internal.signup-enabled` option, we strongly recommend you to set `auth.signup-default-role` to `ReadOnly` (the default value).

---
id: integration-golang
title: Go
sidebar_label: Golang (Push)
slug: /golang
description: Pyroscope Go profiling
keywords: [ pyroscope, go, golang, profiling ]
---

Pyroscope uses the standard `runtime/pprof` package to collect profiling data. Refer to
[the official documentation](https://golang.org/doc/diagnostics#profiling) for details.


#### Supported platforms

| Spy Name     | Type         | Linux | macOS | Windows | Docker |
|:------------:|:------------:|:-----:|:-----:|:-------:|:------:|
| n/a          | `standalone` |   âœ…  |   âœ…  |    âœ…   |   âœ…   |

### Profiling Go application



:::important
This current version of the Go integration requires you to run pyroscope server version `0.3.1` or higher.
We strongly recommend you to upgrade your pyroscope server version and use this new version of the golang client. It reduces both the number of dependancies and peformance overhead. The old documentation is still available [here](/docs/golang-old).
:::



To start profiling a Go application, you need to include our go module in your app:
```
# make sure you also upgrade pyroscope server to version 0.3.1 or higher
go get github.com/pyroscope-io/client/pyroscope
```

Then add the following code to your application:

```go
package main

import "github.com/pyroscope-io/client/pyroscope"

func main() {
  pyroscope.Start(pyroscope.Config{
    ApplicationName: "simple.golang.app",

    // replace this with the address of pyroscope server
    ServerAddress:   "http://pyroscope-server:4040",

    // you can disable logging by setting this to nil
    Logger:          pyroscope.StandardLogger,

    // optionally, if authentication is enabled, specify the API key:
    // AuthToken: os.Getenv("PYROSCOPE_AUTH_TOKEN"),

    // by default all profilers are enabled,
    // but you can select the ones you want to use:
    ProfileTypes: []pyroscope.ProfileType{
      pyroscope.ProfileCPU,
      pyroscope.ProfileAllocObjects,
      pyroscope.ProfileAllocSpace,
      pyroscope.ProfileInuseObjects,
      pyroscope.ProfileInuseSpace,
    },
  })

  // your code goes here
}
```

### Tags

It is possible to add tags (labels) to the profiling data. These tags can be used to filter the data in the UI. We have a custom API that's in line with our other integrations (e.g [Python](/docs/python) or [Ruby](/docs/ruby)) as well as go-native pprof api:

```go
// these two ways of adding tags are equivalent:
pyroscope.TagWrapper(context.Background(), pyroscope.Labels("controller", "slow_controller"), func(c context.Context) {
  slowCode()
})

pprof.Do(context.Background(), pprof.Labels("controller", "slow_controller"), func(c context.Context) {
  slowCode()
})
```



### Pull Mode

Go integration supports pull mode, which means that you can profile applications without adding any extra code. For that to work you will need to make sure you have profiling routes (`/debug/pprof`) enabled in your http server. Generally, that means that you need to add `net/http/pprof` package:
```go
import _ "net/http/pprof"
```


* For information on how to use `net/http/pprof` refer to official [net/http/pprof documentation](https://pkg.go.dev/net/http/pprof).
* For more information on how to set up pyroscope server to pull data from your applications, refer to [pull mode documentation](/docs/golang-pull-mode).


### Tracing integration

Pyroscope can integrate with distributed tracing systems supporting [**OpenTelemetry**](https://opentelemetry.io/docs/instrumentation/go/getting-started/) standard which allows you to
link traces with the profiling data, and find specific lines of code related to a performance issue.

:::note
 * Only CPU profiling is supported at the moment.
 * We recommend you using Go 1.18 to ensure accurate results.
 * Because of how sampling profilers work, spans shorter than the sample interval may not be captured. Go CPU profiler probes stack traces 100 times per second, meaning that spans shorter than 10ms may not be captured.
:::

Go code can be easily instrumented with [otelpyroscope](https://github.com/pyroscope-io/otelpyroscope) package -
a `TracerProvider` implementation, that annotates profiling data with span IDs which makes it possible to filter
out profile of a particular trace span in Pyroscope:

```shell
go get github.com/pyroscope-io/otelpyroscope
```

Now we can create and configure the tracer provider:
```go
// Create an exporter that prints traces to stdout.
exporter, _ := stdouttrace.New(stdouttrace.WithPrettyPrint())
tp := trace.NewTracerProvider(
    trace.WithSampler(trace.AlwaysSample()),
    trace.WithBatcher(exporter),
)
defer func() {
    if err := tp.Shutdown(context.Background()); err != nil {
        log.Fatal(err)
    }
}()

// We wrap the tracer provider to also annotate goroutines with Span ID so
// that pprof would add corresponding labels to profiling samples.
otel.SetTracerProvider(otelpyroscope.NewTracerProvider(tp,
    otelpyroscope.WithAppName("simple.golang.app"),
    otelpyroscope.WithPyroscopeURL("http://pyroscope-server:4040"),
    otelpyroscope.WithRootSpanOnly(true),
    otelpyroscope.WithAddSpanName(true),
    otelpyroscope.WithProfileURL(true),
    otelpyroscope.WithProfileBaselineURL(true),
))
```

Please notice the `WithRootSpanOnly` option: when enabled, the tracer will annotate only the first span created locally
(the root span), but the profile will include samples of all the nested spans. This may be helpful in case if the trace
consists of multiple spans shorter than 10ms and profiler can't collect and annotate samples properly.

Another option that you may find useful is `WithAddSpanName` that controls whether the span name added to profile labels
automatically. You can find description of all the options in [the package documentation](https://pkg.go.dev/github.com/pyroscope-io/otelpyroscope#Option).

:::important
If you enable `WithAddSpanName` option, please make sure span names do not contain unique values, for example, a URL.
Otherwise, this can increase data cardinality and slow down queries.
:::

Now that we set up the tracer, we can create a new trace from anywhere:
```go
ctx, span := otel.Tracer("tracerName").Start(context.Background(), "ExampleSpan")
defer span.End()

// Your code goes here.
```

Collected profiles can be viewed in Pyroscope UI using FlameQL:
 - `simple.golang.app.cpu{profile_id="<spanID>"}` - Shows flamegraph for a particular span.
 - `simple.golang.app.cpu{span_name="ExampleSpan"}` - Shows aggregateg profile for all spans named **ExampleSpan**.

For convenience, the tracer annotates profiled spans with extra attributes:
 - `pyroscope.profile.id` - is set to span ID to indicate that profile was captured for a span.
 - `pyroscope.profile.url` - contains the URL to the flamegraph in Pyroscope UI.
 - `pyroscope.profile.baseline.url` - contains the URL to the baseline comparison view in Pyroscope UI.

You can find a complete example application that demonstrates tracing integration features in our repository:
 - [Jaeger](https://github.com/pyroscope-io/pyroscope/tree/main/examples/tracing/jaeger)
 - [Honeycomb](https://github.com/pyroscope-io/pyroscope/tree/main/examples/tracing/honeycomb)

### Examples

Check out the [examples](https://github.com/pyroscope-io/pyroscope/tree/main/examples/golang-push) directory in our repository to learn more ðŸ”¥
